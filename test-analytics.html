<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Test - LinkedIn Invitation Notepad</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #0077b5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>üß™ LinkedIn Invitation Notepad - Analytics Test</h1>
    
    <div class="test-section">
        <h2>üìä Analytics Data Generation</h2>
        <p>Test the analytics system by generating sample data:</p>
        <button class="test-button" onclick="generateSampleData()">Generate Sample Message History</button>
        <button class="test-button" onclick="generateAnalytics()">Calculate Analytics</button>
        <button class="test-button" onclick="displayResults()">Display Analytics Results</button>
        <div id="analytics-results" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üéØ Response Tracking Test</h2>
        <p>Test the response tracking functionality:</p>
        <button class="test-button" onclick="simulateResponse()">Simulate Message Response</button>
        <button class="test-button" onclick="checkResponseRate()">Check Response Rate</button>
        <div id="response-results" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üí° Insights Generation Test</h2>
        <p>Test the insights generation system:</p>
        <button class="test-button" onclick="generateInsights()">Generate Insights</button>
        <button class="test-button" onclick="testTimeAnalysis()">Test Time Analysis</button>
        <div id="insights-results" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>üîß Data Management Test</h2>
        <p>Test data export/import functionality:</p>
        <button class="test-button" onclick="testExport()">Test Data Export</button>
        <button class="test-button" onclick="clearTestData()">Clear Test Data</button>
        <div id="data-results" class="test-result"></div>
    </div>

    <script>
        // Mock Chrome storage for testing
        const mockStorage = {
            messageHistory: [],
            analytics: {},
            settings: {}
        };

        function generateSampleData() {
            const sampleMessages = [];
            const names = ['John Smith', 'Sarah Johnson', 'Mike Wilson', 'Emma Davis', 'Alex Brown'];
            const tones = ['professional', 'casual', 'friendly', 'assertive'];
            const sources = ['ai', 'manual', 'saved'];
            
            for (let i = 0; i < 20; i++) {
                const timestamp = new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000);
                const message = generateRandomMessage();
                
                sampleMessages.push({
                    id: 'test_' + i,
                    message: message,
                    timestamp: timestamp.toISOString(),
                    source: sources[Math.floor(Math.random() * sources.length)],
                    tone: tones[Math.floor(Math.random() * tones.length)],
                    personInfo: {
                        name: names[Math.floor(Math.random() * names.length)],
                        company: 'Test Company ' + (i % 5),
                        title: 'Software Engineer'
                    },
                    hasResponse: Math.random() > 0.7 // 30% response rate
                });
            }
            
            mockStorage.messageHistory = sampleMessages;
            
            document.getElementById('analytics-results').innerHTML = `
                <span class="success">‚úÖ Generated ${sampleMessages.length} sample messages</span><br>
                <pre>${JSON.stringify(sampleMessages.slice(0, 3), null, 2)}</pre>
            `;
        }

        function generateRandomMessage() {
            const templates = [
                "Hi {name}, I'd love to connect with you and learn more about your work at {company}.",
                "Hello {name}, I noticed we have similar interests in software development. Would you like to connect?",
                "Hi {name}, I'm impressed by your background at {company}. I'd like to add you to my network.",
                "Hello {name}, I saw your recent post about technology trends. Let's connect and share insights!",
                "Hi {name}, I'd be interested in learning more about your experience in the tech industry."
            ];
            
            const template = templates[Math.floor(Math.random() * templates.length)];
            return template.replace('{name}', 'Professional').replace('{company}', 'TechCorp');
        }

        function generateAnalytics() {
            const history = mockStorage.messageHistory;
            if (history.length === 0) {
                document.getElementById('analytics-results').innerHTML = '<span class="error">‚ùå No message history found. Generate sample data first.</span>';
                return;
            }

            const analytics = {
                totalSent: history.length,
                totalResponded: history.filter(msg => msg.hasResponse).length,
                aiGenerated: history.filter(msg => msg.source === 'ai').length,
                averageLength: Math.round(history.reduce((sum, msg) => sum + msg.message.length, 0) / history.length),
                lastUpdated: new Date().toISOString()
            };

            analytics.responseRate = Math.round((analytics.totalResponded / analytics.totalSent) * 100);

            mockStorage.analytics = analytics;

            document.getElementById('analytics-results').innerHTML = `
                <span class="success">‚úÖ Analytics calculated successfully</span><br>
                <pre>${JSON.stringify(analytics, null, 2)}</pre>
            `;
        }

        function displayResults() {
            const analytics = mockStorage.analytics;
            if (!analytics.totalSent) {
                document.getElementById('analytics-results').innerHTML = '<span class="error">‚ùå No analytics data found. Generate analytics first.</span>';
                return;
            }

            const html = `
                <span class="success">üìä Analytics Dashboard Preview:</span><br>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 10px 0;">
                    <div style="background: #f8fafc; padding: 10px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 18px; color: #0077b5; font-weight: bold;">${analytics.totalSent}</div>
                        <div style="font-size: 10px; color: #64748b;">MESSAGES SENT</div>
                    </div>
                    <div style="background: #f8fafc; padding: 10px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 18px; color: #0077b5; font-weight: bold;">${analytics.responseRate}%</div>
                        <div style="font-size: 10px; color: #64748b;">RESPONSE RATE</div>
                    </div>
                    <div style="background: #f8fafc; padding: 10px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 18px; color: #0077b5; font-weight: bold;">${analytics.averageLength}</div>
                        <div style="font-size: 10px; color: #64748b;">AVG. LENGTH</div>
                    </div>
                    <div style="background: #f8fafc; padding: 10px; border-radius: 4px; text-align: center;">
                        <div style="font-size: 18px; color: #0077b5; font-weight: bold;">${analytics.aiGenerated}</div>
                        <div style="font-size: 10px; color: #64748b;">AI GENERATED</div>
                    </div>
                </div>
            `;

            document.getElementById('analytics-results').innerHTML = html;
        }

        function simulateResponse() {
            const history = mockStorage.messageHistory;
            if (history.length === 0) {
                document.getElementById('response-results').innerHTML = '<span class="error">‚ùå No message history found. Generate sample data first.</span>';
                return;
            }

            // Simulate a response to a random unreplied message
            const unresponded = history.filter(msg => !msg.hasResponse);
            if (unresponded.length === 0) {
                document.getElementById('response-results').innerHTML = '<span class="error">‚ùå All messages already have responses.</span>';
                return;
            }

            const randomMessage = unresponded[Math.floor(Math.random() * unresponded.length)];
            randomMessage.hasResponse = true;
            randomMessage.responseDetectedAt = new Date().toISOString();

            document.getElementById('response-results').innerHTML = `
                <span class="success">‚úÖ Response simulated for message to ${randomMessage.personInfo.name}</span><br>
                <pre>Message: "${randomMessage.message}"</pre>
            `;
        }

        function checkResponseRate() {
            const history = mockStorage.messageHistory;
            const totalSent = history.length;
            const totalResponded = history.filter(msg => msg.hasResponse).length;
            const responseRate = totalSent > 0 ? Math.round((totalResponded / totalSent) * 100) : 0;

            document.getElementById('response-results').innerHTML = `
                <span class="success">üìà Response Rate Analysis:</span><br>
                Total Messages: ${totalSent}<br>
                Responses Received: ${totalResponded}<br>
                Response Rate: ${responseRate}%<br>
                <div style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 8px; margin-top: 8px;">
                    üí° Industry average response rate is 15-25%
                </div>
            `;
        }

        function generateInsights() {
            const history = mockStorage.messageHistory;
            if (history.length === 0) {
                document.getElementById('insights-results').innerHTML = '<span class="error">‚ùå No message history found. Generate sample data first.</span>';
                return;
            }

            const insights = [];
            const avgLength = history.reduce((sum, msg) => sum + msg.message.length, 0) / history.length;
            
            if (avgLength < 100) {
                insights.push('üìù Try longer messages (120-150 chars) for better engagement');
            } else if (avgLength > 200) {
                insights.push('‚úÇÔ∏è Consider shorter messages for better response rates');
            }

            const aiCount = history.filter(msg => msg.source === 'ai').length;
            const manualCount = history.length - aiCount;
            
            if (aiCount > manualCount) {
                insights.push('ü§ñ You rely heavily on AI - try personalizing some messages manually');
            } else if (manualCount > aiCount * 2) {
                insights.push('‚ö° Consider using AI generation more often to save time');
            }

            if (insights.length === 0) {
                insights.push('üöÄ Send more messages to unlock personalized insights');
            }

            const insightsHtml = insights.map(insight => `<div style="padding: 5px; border-left: 3px solid #0077b5; margin: 5px 0; background: #f8f9fa;">${insight}</div>`).join('');

            document.getElementById('insights-results').innerHTML = `
                <span class="success">üí° Generated Insights:</span><br>
                ${insightsHtml}
            `;
        }

        function testTimeAnalysis() {
            const history = mockStorage.messageHistory;
            if (history.length === 0) {
                document.getElementById('insights-results').innerHTML = '<span class="error">‚ùå No message history found. Generate sample data first.</span>';
                return;
            }

            const hourCounts = {};
            history.forEach(msg => {
                const hour = new Date(msg.timestamp).getHours();
                hourCounts[hour] = (hourCounts[hour] || 0) + 1;
            });

            const bestHour = Object.keys(hourCounts).reduce((a, b) => hourCounts[a] > hourCounts[b] ? a : b);
            const timeStr = bestHour < 12 ? `${bestHour}:00 AM` : `${bestHour - 12}:00 PM`;

            document.getElementById('insights-results').innerHTML = `
                <span class="success">‚è∞ Time Analysis:</span><br>
                Most active time: ${timeStr}<br>
                Hour distribution:<br>
                <pre>${JSON.stringify(hourCounts, null, 2)}</pre>
            `;
        }

        function testExport() {
            const allData = mockStorage;
            const dataStr = JSON.stringify(allData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Create download link
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-export-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            
            document.getElementById('data-results').innerHTML = `
                <span class="success">‚úÖ Test data exported successfully</span><br>
                Data size: ${dataStr.length} characters<br>
                Contains: ${Object.keys(allData).join(', ')}
            `;
        }

        function clearTestData() {
            mockStorage.messageHistory = [];
            mockStorage.analytics = {};
            mockStorage.settings = {};
            
            document.getElementById('data-results').innerHTML = '<span class="success">‚úÖ Test data cleared</span>';
            document.getElementById('analytics-results').innerHTML = '';
            document.getElementById('response-results').innerHTML = '';
            document.getElementById('insights-results').innerHTML = '';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Analytics test page loaded');
        });
    </script>
</body>
</html> 